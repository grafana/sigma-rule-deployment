name: "Grafana Query Integration"
description: "Take converted rules and convert them into deployable outputs (alert rules, dashboards, etc.) and test them."
author: "security-operations"

inputs:
  config_path:
    description: "Path to the configuration file for the Sigma Rule Deployer"
    required: true
    default: ""
  grafana_sa_token:
    description: "Service account token for Grafana for query testing"
    required: false
    default: ""

outputs:
  rules_integrated:
    description: "The repository file names changed (added/updated or removed) by this Action"

runs:
  using: "docker"
  image: "ghcr.io/grafana/sigma-rule-deployment/sigma-rule-deployer:${{ github.action_sha }}"
  args:
    - integrate
  env:
    ACTION_PATH: ${{ github.action_path }}
    INTEGRATOR_CONFIG_PATH: ${{ inputs.config_path }}
    INTEGRATOR_GRAFANA_SA_TOKEN: ${{ inputs.grafana_sa_token }}
    ADDED_FILES: ${{ steps.changed-files.outputs.added_files }}
    MODIFIED_FILES: ${{ steps.changed-files.outputs.modified_files }}
    DELETED_FILES: ${{ steps.changed-files.outputs.deleted_files }}
    COPIED_FILES: ${{ steps.changed-files.outputs.copied_files }}